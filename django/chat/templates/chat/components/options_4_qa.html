{% extends 'chat/components/options_submenu.html' %}

{% load i18n %}

{% block accordion_title %}
  {% trans "Q&A" %}
{% endblock %}

{% block accordion_body %}
  <div class="px-3">
    <label class="col-form-label col-form-label-sm"
           for="{{ options_form.qa_library.auto_id }}">{% trans "Library" %}</label>
  </div>
  <div class="px-3 row">
    <div class="col pe-0">{{ options_form.qa_library }}</div>
    <div class="col-auto ps-2">
      <button type="button"
              id="editLibrariesButton"
              class="btn btn-outline-dark btn-sm"
              hx-get="{% url 'librarian:modal_edit_library' options_form.qa_library.value %}"
              hx-target="#editLibrariesInner"
              hx-indicator="#librarian-modal-spinner"
              hx-swap="innerHTML"
              onclick="document.getElementById('editLibrariesInner').innerHTML='';"
              data-bs-toggle="modal"
              data-bs-target="#editLibrariesModal">{% trans "Edit libraries" %}</button>
    </div>
  </div>

  <div class="px-3 mt-2">
    {# Select QA scope: entire library, select data sources, or select documents #}
    <div>
      <label class="col-form-label col-form-label-sm"
             for="{{ options_form.qa_scope.auto_id }}">{% trans "Filter results" %}</label>
      {{ options_form.qa_scope }}
    </div>
    {# Data sources autocompletes, selectively visible #}
    <div id="qa_data_sources_autocomplete"
         class="mt-2 small {% if options_form.qa_scope != 'data_sources' %}d-none{% endif %}">
      <div class="visually-hidden">{{ options_form.qa_data_sources.label_tag }}</div>
      {{ options_form.qa_data_sources }}
    </div>
    <div id="qa_documents_autocomplete"
         class="mt-2 small {% if options_form.qa_scope != 'documents' %}d-none{% endif %}">
      <div class="visually-hidden">{{ options_form.qa_documents.label_tag }}</div>
      {{ options_form.qa_documents }}
    </div>
  </div>

  <div class="px-3 mt-2">
    <label class="col-form-label col-form-label-sm"
           for="{{ options_form.qa_model.auto_id }}">{% trans "Model" %}</label>
  </div>
  <div class="px-3">{{ options_form.qa_model }}</div>
  <div class="px-3 mt-3">
    <button type="button"
            id="advancedQaModalButton"
            class="btn btn-outline-dark btn-sm w-100"
            onclick="updateQaModal();"
            data-bs-toggle="modal"
            data-bs-target="#advanced-qa-modal">{% trans "Edit advanced settings and prompts" %}</button>
  </div>
  {# Hidden fields, editable in the advanced_qa_modal #}
  {{ options_form.qa_prompt_template }}
  {{ options_form.qa_system_prompt }}
  {{ options_form.qa_pre_instructions }}
  {{ options_form.qa_post_instructions }}
  {{ options_form.qa_topk }}
  {{ options_form.qa_vector_ratio }}
  {{ options_form.qa_answer_mode }}
  {{ options_form.qa_source_order }}
  {{ options_form.qa_prune }}
  {{ options_form.qa_rewrite }}
{% endblock %}
