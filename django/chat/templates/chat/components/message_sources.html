{% load static %}
{% load i18n %}

{# If there are multiple data sources used in the message, warn the user #}
{% if warn %}
  <hr>
  <div class="mx-5 text-center">
    <i class="bi bi-exclamation-triangle"></i>
    <small style="font-style:italic;">
      {% trans "Your question brought up multiple data sources." %}
      {% trans "To avoid inconsistencies, try being more specific with your question, or select only the relevant data sources in the Settings sidebar." %}
    </small>
  </div>
{% endif %}

<button type="button"
        class="mt-2 btn btn-link m-0 p-0 text-secondary"
        data-bs-toggle="modal"
        data-bs-target="#sources-{{ message.id }}">{% trans "Sources" %}</button>

<!-- Modal -->
<div class="modal modal-xl fade sources-modal"
     id="sources-{{ message.id }}"
     tabindex="-1"
     aria-label='{% trans "Sources" %}'
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{% trans "Sources" %}</h5>
        <button type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label='{% trans "Close" %}'></button>
      </div>
      <div class="modal-body p-0">
        <div class="accordion accordion-flush"
             id="sources-{{ message.id }}-accordion">
          {% for source in sources %}
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button collapsed"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#sources-{{ message.id }}-text-{{ forloop.counter }}"
                        aria-expanded="false"
                        aria-controls="sources-{{ message.id }}-text-{{ forloop.counter }}">
                  [{{ forloop.counter }}: {{ source.data_source_name }}] {{ source.document.citation|safe }}
                </button>
              </h2>
              <div id="sources-{{ message.id }}-text-{{ forloop.counter }}"
                   class="accordion-collapse collapse">
                <div class="accordion-body scrolling-content" style="">
                  <div class="float-end">{{ source.document.citation_href|safe }}</div>
                  <div style="white-space:pre-wrap;">{{ source.node_text|safe }}</div>
                </div>
 
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>
