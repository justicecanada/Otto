{% load i18n %}

{% block page_css %}
  <style>
  .nav-link {
    color: var(--bs-body-color);
    font-size: 0.875rem;
    font-weight: 600;

    &:hover {
      color: var(--bs-gray-900);
      font-weight: bold outline: none;
    }

    &:focus-visible {
      outline: none;
      box-shadow: 0 0 0 0.15rem rgba(66, 70, 73, 0.5);
    }
  }
  </style>
{% endblock page_css %}

<div class="modal-body">
  <div class="d-flex flex-column">
    <ul class="nav nav-underline nav-fill"
        id="preset-edit-tabs"
        role="tablist">
      <li class="nav-item" role="presentation">
        <button id="en-preset-tab"
                class="active nav-link"
                data-bs-target="#en-preset-tab-pane"
                data-bs-toggle="pill"
                type="button"
                role="tab"
                aria-controls="en-preset-tab-pane"
                aria-selected="true">EN</button>
      </li>
      <li class="nav-item" role="presentation">
        <button id="fr-preset-tab"
                class="nav-link"
                data-bs-target="#fr-preset-tab-pane"
                data-bs-toggle="pill"
                type="button"
                role="tab"
                aria-controls="fr-preset-tab-pane"
                aria-selected="false">FR</button>
      </li>
    </ul>

    <div class="tab-content border-bottom pt-4">
      <form class="g-3 mt-1 row" id="edit_preset_form" method="post">
        {% csrf_token %}
        <div class="col-12">
          <label class="form-label" for="id_name_en">{% trans "Title (required)" %}</label>
          {{ form.name_en }}
        </div>
        <div class="col-12">
          <label class="form-label" for="id_description_en">{% trans "Description" %}</label>
          {{ form.description_en }}
        </div>
        <div class="col-12">
          <div class="form-check">
            {{ form.is_public }}
            <label class="form-check-label" for="id_is_public">{% trans "Make preset public" %}</label>
          </div>
        </div>
        <div class="col-12" id="public_fields">
          <div class="mb-3">
            <label class="form-label" for="id_editable_by">{% trans "Editable by: " %}</label>
            {{ form.editable_by }}
          </div>
          <div class="mb-3">
            <label class="form-label" for="id_accessible_to">{% trans "Accessible To: " %}</label>
            {{ form.accessible_to }}
          </div>
        </div>
      </form>
    </div>
  </div>

  <div class="modal-footer">
    <div class="col-12 d-flex justify-content-center mt-2">
      <div class="w-50 d-flex">
        <button id="save_preset"
                class="btn btn-primary flex-fill me-2"
                type="submit"
                hx-post="{% url 'chat:save_preset' chat_id=chat_id %}"
                hx-target="#presets-modal-body"
                hx-include="#edit_preset_form"
                hx-swap="innerHTML transition:true">{% trans "Save" %}</button>
        <button id="cancel_preset"
                class="btn btn-outline-secondary flex-fill"
                hx-get="{% url 'chat:get_presets' chat_id=chat_id %}"
                hx-target="#presets-modal-body"
                hx-swap="innerHTML transition:true"
                type="button">{% trans "Cancel" %}</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.body.addEventListener('htmx:afterSettle', function() {
    const isPublicCheckbox = document.getElementById('id_is_public');
    const publicFields = document.getElementById('public_fields');

    console.log('isPublicCheckbox', isPublicCheckbox);
    console.log('publicFields', publicFields);

    if (isPublicCheckbox) {
      isPublicCheckbox.addEventListener('change', function() {
        console.log('isPublicCheckbox changed');
        if (isPublicCheckbox.checked) {
          publicFields.style.display = 'block';
        } else {
          publicFields.style.display = 'none';
        }
      });

      // Set initial state
      if (isPublicCheckbox.checked) {
        publicFields.style.display = 'block';
      } else {
        publicFields.style.display = 'none';
      }
      console.log('isPublicCheckbox.checked', isPublicCheckbox.checked);
    } else {
      console.error('Checkbox not found');
    }
  });
</script>
