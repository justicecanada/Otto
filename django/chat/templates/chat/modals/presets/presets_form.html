{% load i18n %}

{% block page_css %}
  <style>
  :root {
    --tab-border-color: 0.01rem solid #d5d5d5;
  }

  .nav-link {
    color: var(--bs-body-color);
    font-size: 0.875rem;
    font-weight: 600;
    &:hover {
      color: var(--bs-gray-900);
      font-weight: bold outline: none;
      &:not(.active) {
        background-color: var(--bs-light);
        border-bottom: var(--tab-border-color); 
      }
    }
    &:focus-visible {
      box-shadow: 0 0 0 0.15rem rgba(66, 70, 73, 0.5);
    }
    &:not(.active) {
    background-color: #eaeaea; 
    border-bottom: var(--tab-border-color);
    }
    &.active {
      border-top: var(--tab-border-color) !important; 
      border-left: var(--tab-border-color) !important;
      border-right: var(--tab-border-color) !important; 
    }
  }

  .card-footer {
    display: flex !important;
    gap: 1rem;  
    background-color: transparent;    
    border-top: none;
    padding-top: 0;
    padding-bottom: .65rem;

    button {
      font-size: 0.875rem;
      line-height: 1.25rem;
      flex-grow: 1;

      &:hover {
        background-color: var(--bs-light) !important;        
      }

      &:only-child {
        flex-basis: 100%;
      }
    }
  }
  .language-content {
    display: none;
  }
  .language-content.active {
    display: block;
  }
  .form-check-input:checked {
  background-color: black;
  border-color: black;
  }

  .form-check-input:focus {
    border-color: #a2a2a2;
    box-shadow: 0 0 0 0.25rem rgba(0, 0, 0, 0.25);
  }

  #delete_preset{
    color: red;
    border-color: red;
    &:hover {
      background-color: red !important;
      color: white !important;
    }
  }
  </style>
{% endblock page_css %}


<div class="modal-body">

  <div class="d-flex flex-column">
    <ul class="nav nav-tabs nav-fill" id="preset-edit-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button id="en-preset-tab"
                class="active nav-link"
                data-bs-target="#en-preset-tab-pane"
                data-bs-toggle="pill"
                type="button"
                role="tab"
                aria-controls="en-preset-tab-pane"
                aria-selected="true">EN</button>
      </li>
      <li class="nav-item" role="presentation">
        <button id="fr-preset-tab"
                class="nav-link"
                data-bs-target="#fr-preset-tab-pane"
                data-bs-toggle="pill"
                type="button"
                role="tab"
                aria-controls="fr-preset-tab-pane"
                aria-selected="false">FR</button>
      </li>
    </ul>

    <div class="tab-content border-bottom pt-4">
      <form class="g-3 mt-1 row" id="edit_preset_form" method="post">
        {% csrf_token %}
        <div class="col-12">
          <div id="en-content" class="language-content active">
            <div class="mb-3">
              <label class="form-label" for="id_name_en">
                {% trans "Title (english)" %}<span style="color: red;">*</span>
              </label>
              {{ form.name_en }}
            </div>
            <div class="mb-3">
              <label class="form-group" for="id_description_en">{% trans "Description (english)" %}</label>
              {{ form.description_en }}
            </div>
          </div>
          <div id="fr-content" class="language-content">
            <div class="mb-3">
              <label class="form-label" for="id_name_fr">
                {% trans "Title (french)" %}<span style="color: red;">*</span>
              </label>
              {{ form.name_fr }}
            </div>
            <div class="mb-3">
              <label class="form-label" for="id_description_fr">{% trans "Description (french)" %}</label>
              {{ form.description_fr }}
            </div>
          </div>
        </div>
        <div class="col-12">
          <div class="form-check">
            {{ form.is_public }}
            <label class="form-check-label" for="id_is_public">{% trans "Share with others" %}</label>
          </div>
        </div>
        <div class="col-12" id="public_fields">
          <div class="mb-3">
            <label class="form-label" for="id_editable_by">{% trans "Editable by: " %}</label>
            {{ form.editable_by }}
          </div>
          <div class="mb-3">
            <label class="form-label" for="id_accessible_to">{% trans "Accessible To: " %}</label>
            {{ form.accessible_to }}
          </div>
        </div>
        <div id="error-message">
          {% if error_message %}<div class="alert alert-danger" role="alert">{{ error_message }}</div>{% endif %}
        </div>
      </form>
    </div>
  </div>


  <div class="modal-footer">
    <div class="col-12">
      <div class="row">
        <div class="col-6">
          <button id="cancel_preset"
                  class="btn btn-outline-secondary w-25 flex-fill me-2"
                  hx-get="{% url 'chat:get_presets' chat_id=chat_id %}"
                  hx-target="#presets-modal-body"
                  hx-swap="innerHTML transition:true"
                  type="button">{% trans "Cancel" %}</button>
 
          {% if preset_id %}
            <button id="delete_preset"
                    class="btn btn-outline-secondary w-25 flex-fill"
                    hx-get="{% url 'chat:chat_options' chat_id=chat_id action='delete_preset' preset_id=preset_id %}"
                    hx-target="#presets-modal-body"
                    hx-swap="innerHTML transition:true"
                    hx-confirm="{% trans 'Are you sure you want to delete this preset?' %}"
                    type="button">{% trans "Delete" %}</button>
          {% endif %}
        </div>
        <div class="col-6 text-end">
          <button id="save_preset"
                  class="btn btn-dark flex-fill w-25"
                  type="submit"
                  hx-post="{% if preset_id %}{% url 'chat:chat_options' chat_id=chat_id preset_id=preset_id action='save_preset' %}{% else %}{% url 'chat:chat_options' chat_id=chat_id action='save_preset' %}{% endif %}"
                  hx-include="#edit_preset_form"
                  hx-target="#presets-modal-body"
                  hx-swap="innerHTML">{% trans "Save" %}</button>
 
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<script>
  document.body.addEventListener('htmx:afterSettle', function() {
    const isPublicCheckbox = document.getElementById('id_is_public');
    const publicFields = document.getElementById('public_fields');
    const enTab = document.getElementById('en-preset-tab');
    const frTab = document.getElementById('fr-preset-tab');
    const enContent = document.getElementById('en-content');
    const frContent = document.getElementById('fr-content');

    function togglePublicFields() {
      if (isPublicCheckbox.checked) {
        publicFields.style.display = 'block';
      } else {
        publicFields.style.display = 'none';
      }
    }

    function switchLanguage(lang) {
      if (lang === 'en') {
        enContent.classList.add('active');
        frContent.classList.remove('active');
        enTab.classList.add('active');
        frTab.classList.remove('active');
      } else {
        frContent.classList.add('active');
        enContent.classList.remove('active');
        frTab.classList.add('active');
        enTab.classList.remove('active');
      }
    }

    if (isPublicCheckbox) {
      isPublicCheckbox.addEventListener('change', togglePublicFields);
      togglePublicFields(); // Set initial state
    } else {
      console.error('Checkbox not found');
    }

    enTab.addEventListener('click', () => switchLanguage('en'));
    frTab.addEventListener('click', () => switchLanguage('fr'));
  });
</script>
